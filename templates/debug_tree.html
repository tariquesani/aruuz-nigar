<!doctype html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="utf-8">
    <title>Tree Debug</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            direction: rtl;
        }
        .tree-visualization {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            white-space: pre;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
        }
        .summary {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .paths-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        .path-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 3px solid #4CAF50;
        }
        .code-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            color: #2196F3;
        }
        .word-codes {
            margin: 20px 0;
        }
        .word-codes table {
            width: 100%;
            border-collapse: collapse;
        }
        .word-codes th, .word-codes td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        .word-codes th {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>

<h2>CodeTree Visualization</h2>

<form method="post">
    <input type="text" name="text" value="{{ text_input }}" autofocus style="width: 60%">
    <button type="submit">Visualize Tree</button>
</form>

{% if error %}
    <p style="color:red">{{ error }}</p>
{% endif %}

{% if result %}
    <hr>

    <p><strong>Original text:</strong> {{ result.original_text }}</p>

    <div class="summary">
        <h3>Tree Summary</h3>
        <ul>
            <li><strong>Total Nodes:</strong> {{ result.summary.total_nodes }}</li>
            <li><strong>Total Paths:</strong> {{ result.summary.total_paths }}</li>
            <li><strong>Max Depth:</strong> {{ result.summary.max_depth }}</li>
        </ul>
    </div>

    <h3>Tree Structure</h3>
    <div class="tree-visualization">{{ result.tree_visualization }}</div>

    <h3>Word Codes by Word Reference</h3>
    <div class="word-codes">
        <table>
            <thead>
                <tr>
                    <th>Word Ref</th>
                    <th>Word</th>
                    <th>Codes</th>
                </tr>
            </thead>
            <tbody>
                {% for word_ref, codes in result.summary.word_codes.items() %}
                    <tr>
                        <td>{{ word_ref }}</td>
                        <td>
                            {% for code_info in codes %}
                                {{ code_info.word }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        <td>
                            {% for code_info in codes %}
                                <code>{{ code_info.code }}</code> (ref: {{ code_info.code_ref }}){% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <h3>All Paths ({{ result.total_paths }} total)</h3>
    <div class="paths-container">
        {% for path in result.paths %}
            <div class="path-item">
                <div class="code-display">Path {{ loop.index }}: {{ path.full_code }}</div>
                <details>
                    <summary>Show path details</summary>
                    <ul>
                        {% for loc in path.locations %}
                            <li>
                                Code: <code>{{ loc.code }}</code> | 
                                Word Ref: {{ loc.word_ref }} | 
                                Word: "{{ loc.word }}" | 
                                Code Ref: {{ loc.code_ref }}
                            </li>
                        {% endfor %}
                    </ul>
                </details>
            </div>
        {% endfor %}
    </div>

{% endif %}

</body>
</html>

