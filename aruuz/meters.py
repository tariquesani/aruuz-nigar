"""
Meter definitions for Urdu poetry.

This module contains all meter patterns, names, and foot definitions.
"""

from typing import List
from aruuz.models import Feet


# Constants
NUM_METERS = 129
NUM_VARIED_METERS = 0
NUM_RUBAI_METERS = 12
NUM_SPECIAL_METERS = 11

# Meter ID array (for reference, not used in Phase 1)
METER_IDS = [
    13, 14, 15, 16, 17, 2, 2, 4, 4, 4, 4, 18, 19, 3, 3, 20, 21, 22, 23, 5, 5, 5, 24, 25, 26, 27, 6, 6, 6, 6, 30, 31, 32, 33, 34, 35, 35, 35, 35, 36, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
    51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 7, 103, 64, 65, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 1, 1, 1, 1, 11, 11, 78, 79, 80, 81, 12, 12, 12, 12, 12,
    82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 36, 96, 97, 98, 99, 100, 101, 102, 103, 104
]

# Usage flags (1 = used, 0 = not used)
USAGE = [
    1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
]

# Regular meter patterns
METERS = [
    "-===/-===/-===/-===",
    "-===/-===/-===/-==",
    "-=-=/-=-=/-=-=/-=-=",
    "=-=/-===+=-=/-===",
    "-=-=/-===/-=-=/-===",
    "==-/-==-/-==-/-===",
    "==-/-===+==-/-===",
    "==-/-==-/-==-/-==",
    "===/==-/-==-/-==",
    "==-/-===/==-/-==",
    "==-/-==-/-===/==",
    "-===/-===/-===",
    "-===/-===/-==",
    "==-/-=-=/-==",
    "===/=-=/-==",
    "=-=/-=-=+=-=/-=-=",
    "-===/-==",
    "-===/-==+-===/-==",
    "==-=/==-=/==-=/==-=",
    "=--=/=--=/=--=/=--=",
    "=--=/-=-=+=--=/-=-=",
    "-=-=/=--=+-=-=/=--=",
    "==-=/==-=/==-=",
    "=--=/=--=/=--=",
    "=-==/=-==/=-==/=-==",
    "=-==/=-==/=-==/=-=",
    "=-==/--==/--==/--=",
    "--==/--==/--==/--=",
    "=-==/--==/--==/==",
    "--==/--==/--==/==",
    "--=-/=-==+--=-/=-==",
    "==-/=-==+==-/=-==",
    "--==/--==/--==/--==",
    "=-==/=-==/=-==",
    "=-==/=-==/=-=",
    "=-==/--==/--=",
    "=-==/--==/==",
    "--==/--==/--=",
    "--==/--==/==",
    "--==/--==/--==",
    "-==/-==/-==/-==",
    "-==/-==/-==/-==/-==/-==/-==/-==",
    "-==/-==/-==/-=",
    "=-/-=-/-=-/-==",
    "=-/-=-/-=-/-=",
    "=-/-=-/-=-/-=-/-=-/-=-/-=-/-=",
    "=-/-=-/-=-/-=-/-=-/-=-/-=-/-==",
    "-==/-==/-==",
    "-==/-==/-=",
    "==/-==/==/-==",
    "=-=/=-=/=-=/=-=",
    "--=/--=/--=/--=",
    "--=/--=/--=/--=/--=/--=/--=/--=",
    "=-=/=-=/=-=/--=",
    "=-=/=-=/=-=",
    "=-=/-=/=-=/-=",
    "--=-=/--=-=/--=-=/--=-=",
    "--=-=/--=-=/--=-=",
    "-=--=/-=--=/-=--=/-=--=",
    "-=--=/-=--=/-=--=",
    "-=--=/-=--=/-==",
    "-===/=-==/-===/=-==",
    "-==-/=-=-/-==-/=-=",
    "==-/=-==/==-/=-==",
    "==-/=-=-/-==-/=-=",
    "==-/=-==/==-/=-=",
    "==-/=-=-/-===",
    "==-=/=-==/==-=/=-==",
    "-=-=/--==/-=-=/--==",
    "-=-=/===/-=-=/--==",
    "-=-=/--==/-=-=/===",
    "-=-=/===/-=-=/===",
    "-=-=/--==/-=-=/--=",
    "-=-=/===/-=-=/--=",
    "-=-=/--==/-=-=/==",
    "-=-=/===/-=-=/==",
    "-=-=/--==/-=-=",
    "-=-=/===/-=-=",
    "==-=/===-/==-=/===-",
    "=--=/=-=+=--=/=-=",
    "=--=/=-=-/=--=/=",
    "=--=/=-=/=--=",
    "===-/==-=/===-/==-=",
    "=-=-/=--=/=-=-/=--=",
    "==-=/==-=/===-",
    "=--=/=--=/=-=",
    "==-=/==-=/-==",
    "=-==/==-=/=-==/==-=",
    "=-==/==-=/=-==",
    "--==/-=-=/--==",
    "=-==/-=-=/--=",
    "--==/-=-=/--=",
    "=-==/-=-=/==",
    "--==/-=-=/==",
    "=-==/-=-=/=",
    "--==/-=-=/=",
    "-===/-==/-===",
    "-==/-===/-==/-=-=",
    "-==/-=-=/-==/-=-=",
    "=-==/=-=/=-==/=-=",
    "--==/--=/--==/--=",
    "--==/==/--==/--=",
    "===/--=/--==/--=",
    "--==/--=/===/--=",
    "--==/--=/--==/==",
    "=-==/--=/=-==/--=",
    "==-=/=-=/==-=/=-=",
    "-=-=/--=/-=-=/--=",
    "-===/-===/=-==",
    "==-/-==-/=-==",
    "=-==/=-==/==-=",
    "--==/--==/-=-=",
    "=-==/-===/-===",
    "=-=-/-==-/-==",
    "-=-==/-=-==/-=-==/-=-==",
    "=-=/-===",
    "=-=/-=-=",
    "-===/-===",
    "-=-=/-=-=/-=-=/-=",
    "=-==/--==/--==",
    "-===/-===",
    "=-==/=-==",
    "=-==/=-=",
    "-==/-==",
    "--=-=/--=-=",
    "-==/-===",
    "=-==/=-=",
    "-===/-===/-===/-===/-===/-===/-===/-===",
    "-=-==/-=-=="
]

# Meter names in Urdu
METER_NAMES = [
    "ہزج مثمن سالم",
    "ہزج مثمن محذوف",
    "ہزج مثمن مقبوض",
    "ہزج مثمن اشتر",
    "ہزج مثمن مقبوض سالم",
    "ہزج مثمن اخرب مکفوف سالم",
    "ہزج مثمن اخرب سالم",
    "ہزج مثمن اخرب مکفوف محذوف",
    "ہزج مثمن اخرب مکفوف محذوف",
    "ہزج مثمن اخرب مکفوف محذوف",
    "ہزج مثمن اخرب مکفوف محذوف",
    "ہزج مسدس سالم",
    "ہزج مسدس محذوف",
    "ہزج مسدس اخرب مقبوض محذوف",
    "ہزج مسدس اخرم اشتر محذوف",
    "ہزج مربع اشتر مقبوض مضاعف",
    "ہزج مربع محذوف",
    "ہزج مربع محذوف مضاعف",
    "رجز مثمن سالم",
    "رجز مثمن مطوی",
    "رجز مثمن مطوی مخبون",
    "رجز مثمن مخبون مطوی",
    "رجز مسدس سالم",
    "رجز مسدس مطوی",
    "رمل مثمن سالم",
    "رمل مثمن محذوف",
    "رمل مثمن سالم مخبون محذوف",
    "رمل مثمن سالم مخبون محذوف",
    "رمل مثمن مخبون محذوف مقطوع",
    "رمل مثمن مخبون محذوف مقطوع",
    "رمل مثمن مشکول",
    "رمل مثمن مشکول مسکّن",
    "رمل مثمن مخبون",
    "رمل مسدس سالم",
    "رمل مسدس محذوف",
    "رمل مسدس مخبون محذوف",
    "رمل مسدس مخبون محذوف مسکن",
    "رمل مسدس مخبون محذوف",
    "رمل مسدس مخبون محذوف مسکن",
    "رمل مسدس مخبون",
    "متقارب مثمن سالم",
    "متقارب مثمن سالم مضاعف",
    "متقارب مثمن محذوف",
    "متقارب مثمن اثرم مقبوض",
    "متقارب مثمن اثرم مقبوض محذوف",
    "متقارب مثمن اثرم مقبوض مضاعف",
    "متقارب مثمن اثرم مقبوض محذوف مضاعف",
    "متقارب مسدس سالم",
    "متقارب مسدس محذوف",
    "متقارب مربع اثلم سالم مضاعف",
    "متدارک مثمن سالم",
    "متدارک مثمن مخبون",
    "متدارک مثمن مخبون مضاعف",
    "متدارک مثمن سالم مقطوع",
    "متدارک مسدس سالم",
    "متدارک مربع مخلع مضاعف",
    "کامل مثمن سالم",
    "کامل مسدس سالم",
    "وافر مثمن سالم",
    "وافر مسدس سالم",
    "وافر مسدس مقطوف",
    "مضارع مثمن سالم",
    "مضارع مثمن مکفوف محذوف",
    "مضارع مثمن اخرب",
    "مضارع مثمن اخرب مکفوف محذوف",
    "مضارع مثمن اخرب محذوف",
    "مضارع مسدس اخرب مکفوف",
    "مجتث مثمن سالم",
    "مجتث مثمن مخبون",
    "مجتث مثمن مخبون",
    "مجتث مثمن مخبون",
    "مجتث مثمن مخبون",
    "مجتث مثمن مخبون محذوف",
    "مجتث مثمن مخبون محذوف",
    "مجتث مثمن مخبون محذوف مسکن",
    "مجتث مثمن مخبون محذوف مسکن",
    "مجتث مسدس مخبون",
    "مجتث مسدس مخبون",
    "منسرح مثمن سالم",
    "منسرح مثمن مطوی مکسوف",
    "منسرح مثمن مطوی منحور",
    "منسرح مسدس مطوی مکسوف",
    "مقتضب مثمن سالم",
    "مقتضب مثمن مطوی",
    "سریع مسدس سالم",
    "سریع مسدس مطوی مکسوف",
    "سریع مسدس مخبون مکسوف",
    "خفیف مثمن سالم",
    "خفیف مسدس سالم",
    "خفیف مسدس مخبون",
    "خفیف مسدس مخبون محذوف",
    "خفیف مسدس مخبون محذوف",
    "خفیف مسدس مخبون محذوف مقطوع",
    "خفیف مسدس مخبون محذوف مقطوع",
    "خفیف مسدس سالم مخبون محجوف",
    "خفیف مسدس مخبون محجوف",
    "طویل مثمن سالم",
    "طویل مثمن سالم مقبوض",
    "طویل مثمن مقبوض",
    "مدید مثمن سالم",
    "مدید مثمن مخبون",
    "مدید مثمن مخبون",
    "مدید مثمن مخبون",
    "مدید مثمن مخبون",
    "مدید مثمن مخبون",
    "مدید مثمن سالم مخبون",
    "بسیط مثمن سالم",
    "بسیط مثمن مخبون",
    "قریب مسدس سالم",
    "قریب مسدس اخرب مکفوف",
    "جدید مسدس سالم",
    "جدید مسدس مخبون",
    "مشاکل مسدس سالم",
    "مشاکل مسدس مکفوف محذوف",
    "جمیل مثمن سالم",
    "ہزج مربع اشتر",
    "ہزج مربع اشتر مقبوض",
    "ہزج مربع سالم",
    "ہزج مثمن مقبوض محذوف",
    "رمل مسدس مخبون",
    "ہزج مربع سالم",
    "رمل مربع سالم",
    "ہزج مربع محذوف",
    "متقارب مربع سالم",
    "کامل مربع سالم",
    "طویل مربع سالم",
    "مدید مربع سالم",
    "ہزج مثمن سالم مضاعف",
    "جمیل مربع سالم"
]

# Varied meters (for future use)
METERS_VARIED = [
    "--==/-=-=/==",
    "--==/-=-=/--=",
    "--==/--==/==",
    "--==/--==/--=",
    "--==/--==/--==/==",
    "--==/--==/--==/--=",
    "--==/--==/--=="
]

METERS_VARIED_NAMES = [
    "خفیف مسدّس مخبون محذوف مقطوع",
    "خفیف مسدّس مخبون محذوف",
    "رمل مسدّس مخبون محذوف مقطوع",
    "رمل مسدّس مخبون محذوف",
    "رمل مثمّن مخبون محذوف مقطوع",
    "رمل مثمّن مخبون محذوف",
    "رمل مسدس مخبون"
]

# Rubai meters
RUBAI_METERS = [
    "==-/-==-/-==-/-=",
    "==-/-==-/-===/=",
    "==-/-=-=/-===/=",
    "==-/-=-=/-==-/-=",
    "===/=-=/-==-/-=",
    "===/=-=/-===/=",
    "==-/-===/===/=",
    "==-/-===/==-/-=",
    "===/===/==-/-=",
    "===/===/===/=",
    "===/==-/-===/=",
    "===/==-/-==-/-="
]

RUBAI_METER_NAMES = [
    "ہزج مثمّن اخرب مکفوف مجبوب",
    "ہزج مثمّن اخرب مکفوف ابتر",
    "ہزج مثمّن اخرب مقبوض ابتر",
    "ہزج مثمّن اخرب مقبوض مکفوف مجبوب",
    "ہزج مثمّن اخرم اشتر مکفوف مجبوب",
    "ہزج مثمّن اخرم اشتر ابتر",
    "ہزج مثمّن اخرب اخرم ابتر",
    "ہزج مثمّن اخرب مجبوب",
    "ہزج مثمّن اخرم اخرب مجبوب",
    "ہزج مثمّن اخرم ابتر",
    "ہزج مثمّن اخرم اخرب ابتر",
    "ہزج مثمّن اخرم اخرب مکفوف مجبوب"
]

# Special meters (Hindi/Zamzama)
SPECIAL_METERS = [
    "=(=)/=(=)/=(=)/=(=)/=(=)/=(=)/=(=)/=",
    "=(=)/=(=)/=(=)/=(=)/=(=)/=",
    "=(=)/=(=)/=(=)/=(=)/=(=)/=(=)/=(=)/==",
    "=(=)/=(=)/=(=)/=",
    "=(=)/=(=)/=(=)/==",
    "=(=)/=(=)/=",
    "=(=)/=(=)/=(=)/=(=)/=(=)/==",
    "=(=)/=(=)",
    "(=)=/(=)=/(=)=/(=)=/(=)=/(=)=/(=)=/(=)=",
    "(=)=/(=)=/(=)=/(=)=/(=)=/(=)=",
    "(=)=/(=)=/(=)=/(=)"
]

SPECIAL_METERS_AFAIL = [
    "فعلن فعلن فعلن فعلن فعلن فعلن فعلن فع",
    "فعلن فعلن فعلن فعلن فعلن فع",
    "فعلن فعلن فعلن فعلن فعلن فعلن فعلن فعلن",
    "فعلن فعلن فعلن فع",
    "فعلن فعلن فعلن فعلن",
    "فعلن فعلن فع",
    "فعلن فعلن فعلن فعلن فعلن فعلن",
    "فعلن فعلن",
    "فعلن فعلن فعلن فعلن فعلن فعلن فعلن فعلن",
    "فعلن فعلن فعلن فعلن فعلن فعلن",
    "فعلن فعلن فعلن فعلن"
]

SPECIAL_METER_NAMES = [
    "بحرِ ہندی/ متقارب مثمن مضاعف",
    "بحرِ ہندی/ متقارب مسدس مضاعف",
    "بحرِ ہندی/ متقارب اثرم مقبوض محذوف مضاعف",
    "بحرِ ہندی/ متقارب مربع مضاعف",
    "بحرِ ہندی/ متقارب اثرم مقبوض محذوف",
    "بحرِ ہندی/ متقارب مثمن محذوف",
    "بحرِ ہندی/ متقارب مسدس محذوف",
    "بحرِ ہندی/ متقارب مربع محذوف",
    "بحرِ زمزمہ/ متدارک مثمن مضاعف",
    "بحرِ زمزمہ/ متدارک مسدس مضاعف",
    "بحرِ زمزمہ/ متدارک مربع مضاعف"
]

# Foot patterns
FEET = [
    "===",
    "==-=",
    "==-",
    "==",
    "=-==",
    "=-=-",
    "=-=",
    "=--=",
    "=-",
    "=",
    "-===",
    "-==-",
    "-==",
    "-=-=",
    "-=-",
    "-=",
    "--==",
    "--=-=",
    "--=-",
    "--=",
    "-=-==",
    "===-",
    "-=--=",
    "==-=-",
    "=-==-",
    "=--=-",
    "-===-",
    "-=-=-",
    "--==-",
    "--=-=-",
    "-=-==-",
    "-=--=-"
]

# Foot names in Urdu
FEET_NAMES = [
    "مفعولن",
    "مستفعلن",
    "مفعول",
    "فِعْلن",
    "فاعلاتن",
    "فاعلاتُ",
    "فاعلن",
    "مفتَعِلن",
    "فِعْل",
    "فِع",
    "مفاعیلن",
    "مفاعیل",
    "فعولن",
    "مفاعلن",
    "فعول",
    "فَعَل",
    "فَعِلاتن",
    "متَفاعلن",
    "فَعِلات",
    "فَعِلن",
    "مَفاعلاتن",
    "مفعولاتُ",
    "مفاعِلَتن",
    "مستفعلان",
    "فاعلاتان",
    "مفتَعِلان",
    "مفاعیلان",
    "مفاعلان",
    "فَعِلاتان",
    "متَفاعلان",
    "مَفاعلاتان",
    "مفاعِلَتان"
]


def meter_index(meter_name: str) -> List[int]:
    """
    Find indices of meters matching the given meter name.
    
    Args:
        meter_name: Name of the meter in Urdu
        
    Returns:
        List of indices where the meter name matches
    """
    indices = []
    for i in range(NUM_METERS):
        if METER_NAMES[i] == meter_name:
            indices.append(i)
    return indices


def afail(meter: str) -> str:
    """
    Convert meter pattern to foot names (afail).
    
    Args:
        meter: Meter pattern string (e.g., "-===/-===/-===/-===")
        
    Returns:
        String of foot names separated by spaces
    """
    feet_str = ""
    for part in meter.split('+'):
        for foot_pattern in part.split('/'):
            for i, foot in enumerate(FEET):
                if foot == foot_pattern:
                    feet_str += " " + FEET_NAMES[i]
                    break
    return feet_str.strip()


def afail_list(meter: str) -> List[Feet]:
    """
    Convert meter pattern to list of Feet objects with names and codes.
    
    Args:
        meter: Meter pattern string (e.g., "-===/-===/-===/-===")
        
    Returns:
        List of Feet objects, each containing foot name and code
    """
    feet_list = []
    for part in meter.split('+'):
        for foot_pattern in part.split('/'):
            for i, foot in enumerate(FEET):
                if foot == foot_pattern:
                    feet_obj = Feet()
                    feet_obj.foot = FEET_NAMES[i]
                    feet_obj.code = FEET[i]
                    feet_list.append(feet_obj)
                    break
    return feet_list


def afail_hindi(meter_name: str) -> str:
    """
    Get afail for Hindi/Zamzama special meters.
    
    Args:
        meter_name: Name of the special meter
        
    Returns:
        Afail string for the special meter
    """
    for i in range(NUM_SPECIAL_METERS):
        if SPECIAL_METER_NAMES[i] == meter_name:
            return SPECIAL_METERS_AFAIL[i]
    return ""


def rukn(code: str) -> str:
    """
    Convert scansion code to foot name (rukn).
    
    Args:
        code: Scansion code (e.g., "===", "==-")
        
    Returns:
        Foot name in Urdu, or empty string if not found
    """
    # Replace 'x' with '=' for matching
    code = code.replace('x', '=')
    for i, foot in enumerate(FEET):
        if foot == code:
            return FEET_NAMES[i]
    return ""


def rukn_code(name: str) -> str:
    """
    Convert foot name to scansion code.
    
    Args:
        name: Foot name in Urdu
        
    Returns:
        Scansion code pattern, or empty string if not found
    """
    name = name.strip()
    for i, foot_name in enumerate(FEET_NAMES):
        if foot_name == name:
            return FEET[i]
    return ""
